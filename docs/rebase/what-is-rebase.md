# ЁЯОп `git rebase` ржХрзА?

`git rebase` Git-ржПрж░ ржПржХржЯрж┐ ржХржорж╛ржирзНржб, ржпрж╛ ржПржХ ржмрзНрж░рж╛ржЮрзНржЪрзЗрж░ ржЗрждрж┐рж╣рж╛рж╕ржХрзЗ ржЕржирзНржп ржмрзНрж░рж╛ржЮрзНржЪрзЗрж░ рж╢рзЗрж╖ ржХржорж┐ржЯрзЗрж░ ржкрж░ рж╕рзНржерж╛ржирж╛ржирзНрждрж░ ржХрж░рзЗред

рж╕рж╣ржЬржнрж╛ржмрзЗ ржмрж▓рж▓рзЗ:

> **"ржЖржорж╛рж░ ржХрж╛ржЬржЯрж╛ ржпрзЗржи рж╢рзЗрж╖ рж╣рзЯ `main` ржмрзНрж░рж╛ржЮрзНржЪрзЗрж░ рж╕рж░рзНржмрж╢рзЗрж╖ ржЖржкржбрзЗржЯрзЗрж░ ржкрж░рзЗ тАФ ржПржоржиржнрж╛ржмрзЗ ржЗрждрж┐рж╣рж╛рж╕ рж╕рж╛ржЬрж╛ржУред"**


## ЁЯУМ `git rebase` ржХрзЗржи ржжрж░ржХрж╛рж░?

* ржЗрждрж┐рж╣рж╛рж╕ ржкрж░рж┐рж╖рзНржХрж╛рж░ рж░рж╛ржЦрждрзЗ
* `merge` ржПрж░ ржорждрзЛ ржЕрждрж┐рж░рж┐ржХрзНржд ржХржорж┐ржЯ ржирж╛ ржХрж░рзЗ рж╕рж░рж▓ ржЗрждрж┐рж╣рж╛рж╕ рждрзИрж░рж┐ ржХрж░рждрзЗ
* Pull request-ржПрж░ ржЖржЧрзЗ ржХржорж┐ржЯржЧрзБрж▓рзЛ рж╕рзБржирзНржжрж░ржнрж╛ржмрзЗ рж╕рж╛ржЬрж╛рждрзЗ


## ЁЯЖЪ `merge` vs `rebase`

| ржмрж┐рж╖рзЯ                   | `merge`                        | `rebase`                              |
| ---------------------- | ------------------------------ | ------------------------------------- |
| ржирждрзБржи commit рждрзИрж░рж┐ рж╣рзЯ    | тЬЕ (ржПржХржЯрж╛ merge commit)          | тЭМ (ржкрзБрж░ржирзЛ commit-ржЧрзБрж▓рзЛржХрзЗ ржЖржмрж╛рж░ рждрзИрж░рж┐ ржХрж░рзЗ) |
| ржЗрждрж┐рж╣рж╛рж╕ ржХрзЗржоржи рж╣рзЯ         | рж╢рж╛ржЦрж╛ржмрж┐ржнржХрзНржд (branching history) | рж╕рж░рж▓ (linear history)                  |
| рж╕рж╣ржЬ                    | рж╣рзНржпрж╛ржБ                          | ржПржХржЯрзБ ржЬржЯрж┐рж▓                             |
| Pull Request ржП ржмрзНржпржмрж╣рж╛рж░ | ржорж╛ржЭрзЗржоржзрзНржпрзЗ                      | ржмрзЗрж╢рж┐ ржЬржиржкрзНрж░рж┐рзЯ                          |


## ЁЯУМ Basic Rebase Example

ржзрж░рж┐ ржЖржкржирж╛рж░ `main` ржП ржЖржЫрзЗ ржПржЗ commit:

```
A---B---C  (main)
```

ржПржмржВ `feature` ржмрзНрж░рж╛ржЮрзНржЪрзЗ ржЖржЫрзЗ:

```
A---B---C  (main)
         \
          D---E  (feature)
```

ржПржЦржи ржЖржкржирж┐ `feature` ржмрзНрж░рж╛ржЮрзНржЪрзЗ ржЧрж┐рзЯрзЗ ржЪрж╛рж▓рж╛ржи:

```bash
git rebase main
```

Git ржХрж░ржмрзЗ:

```
A---B---C---D'---E'  (feature)
```

ржорж╛ржирзЗ, `D` ржПржмржВ `E` ржХрзЗ `C` ржПрж░ ржкрж░ ржирждрзБржи ржХрж░рзЗ ржмрж╕рж╛ржмрзЗред


## ЁЯФз Rebase ржХрж░рж╛рж░ ржзрж╛ржк

```bash
git checkout feature
git rebase main
```

ЁЯФБ ржЖржкржирж╛рж░ ржХржорж┐ржЯржЧрзБрж▓рзЛ main-ржПрж░ ржкрж░рзЗ ржирж┐рзЯрзЗ ржпрж╛ржмрзЗред


## тЪФя╕П Conflict рж╣рж▓рзЗ ржХрзА ржХрж░ржмрзЗржи?

```bash
# ржлрж╛ржЗрж▓ ржПржбрж┐ржЯ ржХрж░рзЗ ржарж┐ржХ ржХрж░рзБржи
git add .

# рждрж╛рж░ржкрж░
git rebase --continue
```

ржмржирзНржз ржХрж░рждрзЗ ржЪрж╛ржЗрж▓рзЗ:

```bash
git rebase --abort
```


## ЁЯзк ржЙржжрж╛рж╣рж░ржг рзз: рж▓рзЛржХрж╛рж▓ ржмрзНрж░рж╛ржЮрзНржЪ main-ржПрж░ рж╕рж╛ржерзЗ ржЖржкржбрзЗржЯ рж░рж╛ржЦрж╛

```bash
git checkout feature
git fetch origin
git rebase origin/main
```

тЮбя╕П main ржПрж░ рж╕рж░рзНржмрж╢рзЗрж╖ ржЖржкржбрзЗржЯрзЗрж░ ржкрж░рзЗ ржЖржкржирж╛рж░ ржХрж╛ржЬ ржмрж╕рж╛ржирзЛ рж╣ржмрзЗред


## ЁЯзк ржЙржжрж╛рж╣рж░ржг рзи: rebase ржХрж░рзЗ Push

```bash
git rebase main
git push --force-with-lease
```

тЮбя╕П ржЗрждрж┐рж╣рж╛рж╕ ржкрж╛рж▓рзНржЯрзЗржЫрзЗ ржмрж▓рзЗ, ржЖржкржирж╛ржХрзЗ force push ржХрж░рждрзЗ рж╣ржмрзЗред


## ЁЯзк ржЙржжрж╛рж╣рж░ржг рзй: ржЗржирзНржЯрж╛рж░тАМрзНржпрж╛ржХрзНржЯрж┐ржн Rebase ржжрж┐рзЯрзЗ ржХржорж┐ржЯ ржкрж░рж┐рж╖рзНржХрж╛рж░

```bash
git rebase -i HEAD~3
```

тЮбя╕П рж╢рзЗрж╖ рзйржЯрж┐ ржХржорж┐ржЯржХрзЗ ржЖржкржирж┐ ржПржХрж╕рж╛ржерзЗ squash, edit, drop ржЗрждрзНржпрж╛ржжрж┐ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржиред

**ржЙржжрж╛рж╣рж░ржг:**

```
pick 123abc Add login form
pick 456def Fix typo
pick 789ghi Add validation

# ржЖржкржирж┐ ржЪрж╛ржЗрж▓рзЗ ржХрж░рждрзЗ ржкрж╛рж░рзЗржи:
squash 456def
squash 789ghi
```

тЮбя╕П рж╕ржм ржПржХ ржХрж░рзЗ ржПржХржЯрж╛ рж╕рзБржирзНржжрж░ ржХржорж┐ржЯ ржмрж╛ржирж┐рзЯрзЗ ржлрзЗрж▓рзБржиред


## ЁЯзк ржЙржжрж╛рж╣рж░ржг рзк: `rebase --onto` ржжрж┐рзЯрзЗ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржЬрж╛рзЯржЧрж╛рзЯ ржмрж╕рж╛ржирзЛ

ржзрж░рж┐ ржЖржкржирж╛рж░ ржПржЗ ржЗрждрж┐рж╣рж╛рж╕:

```
A---B---C (main)
     \
      D---E (feature)
```

ржПржЦржи ржЖржкржирж┐ `feature` ржПрж░ `D` ржмрж╛ржж ржжрж┐рзЯрзЗ рж╢рзБржзрзБ `E` ржХрзЗ `C` ржПрж░ ржкрж░рзЗ ржмрж╕рж╛рждрзЗ ржЪрж╛ржи:

```bash
git checkout feature
git rebase --onto main D
```

ржлрж▓рж╛ржлрж▓:

```
A---B---C---E' (feature)
```


## ЁЯзк ржЙржжрж╛рж╣рж░ржг рзл: ржЕржирзНржпржжрзЗрж░ PR review ржХрж░рж╛рж░ ржкрж░ rebase

```bash
git checkout feature
git fetch origin
git rebase origin/main
git push --force-with-lease
```

тЮбя╕П ржПржЯрж╛ ржХрж░рж╛рж░ ржлрж▓рзЗ ржЖржкржирж╛рж░ Pull Request ржЕржирзЗржХ ржкрж░рж┐ржЪрзНржЫржирзНржи ржжрзЗржЦрж╛ржмрзЗред


## ЁЯзп ржнрзБрж▓ ржХрж░рж▓рзЗ ржХрзА ржХрж░ржмрзЗржи?

```bash
git rebase --abort
```

тЮбя╕П rebase ржЪрж▓рж╛ржХрж╛рж▓рзАржи ржнрзБрж▓ рж╣рж▓рзЗ ржПржнрж╛ржмрзЗ ржлрж┐рж░рж┐рзЯрзЗ ржирж┐рждрзЗ ржкрж╛рж░рзЗржиред

ржЕржержмрж╛

```bash
git reflog
git reset --hard <old-commit-id>
```

тЮбя╕П ржЖржЧрзЗрж░ ржЕржмрж╕рзНржерж╛ ржлрж┐рж░рж┐рзЯрзЗ ржЖржирзБржиред


## тЬЕ ржХржЦржи `rebase` ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗржи?

| ржкрж░рж┐рж╕рзНржерж┐рждрж┐                              | `rebase` ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗржи?          |
| -------------------------------------- | -------------------------------- |
| ржЖржкржирж┐ ржПржХрж╛ ржХрж╛ржЬ ржХрж░ржЫрзЗржи                     | тЬФя╕П рж╣рзНржпрж╛ржБ                         |
| ржЯрж┐ржорзЗ ржХрж╛ржЬ ржХрж░ржЫрзЗржи ржПржмржВ force push ржХрж░рж╛ ржпрж╛ржмрзЗ | тЪая╕П рж╣рзНржпрж╛ржБ, рж╕рждрж░рзНржХ ржерж╛ржХрзБржи            |
| ржЕржирзЗржХ ржЕржЧрзЛржЫрж╛рж▓рзЛ commit                    | тЬФя╕П рж╣рзНржпрж╛ржБ, ржЗржирзНржЯрж╛рж░тАМрзНржпрж╛ржХрзНржЯрж┐ржн rebase |
| production/history рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рж╛ ржЬрж░рзБрж░рж┐   | тЭМ ржирж╛                             |


## тЬЕ Rebase ржХрж░рж╛рж░ ржирж┐рзЯржо ржЯрж┐ржорзЗ (Best Practice)

* рж╕рж░рзНржмржжрж╛ `--force-with-lease` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржиред
* ржЕржирзНржпржжрзЗрж░ ржХрж╛ржЬрзЗрж░ ржУржкрж░ `rebase` ржХрж░ржмрзЗржи ржирж╛ ржпржжрж┐ ржирж╛ ржЖржкржирж┐ ржПржХрж╛ ржХрж╛ржЬ ржХрж░рзЗржиред
* `main` ржмрж╛ `master` ржмрзНрж░рж╛ржЮрзНржЪрзЗ ржХржЦржиржУ `rebase` ржХрж░ржмрзЗржи ржирж╛ред


## ЁЯзн ржПржХржЯрж┐ ржкрзВрж░рзНржг rebase workflow ржЙржжрж╛рж╣рж░ржг

```bash
git checkout feature/cart-update
git fetch origin
git rebase origin/main
# conflict рж╣рж▓рзЗ ржлрж┐ржХрзНрж╕ ржХрж░рзЗ:
git add .
git rebase --continue
# рж╢рзЗрж╖рзЗ
git push --force-with-lease
```


## ЁЯФЪ ржЙржкрж╕ржВрж╣рж╛рж░

* тЬЕ `git rebase` ржЗрждрж┐рж╣рж╛рж╕ ржкрж░рж┐ржЪрзНржЫржирзНржи ржУ рж▓рж┐ржирж┐рзЯрж╛рж░ рж░рж╛ржЦрждрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░рзЗред
* тЭЧ рж╕рждрж░рзНржХржнрж╛ржмрзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи тАФ ржЗрждрж┐рж╣рж╛рж╕ ржкрж░рж┐ржмрж░рзНрждрж┐ржд рж╣рзЯред
* ЁЯТб `merge` ржУ `rebase` ржжрзБржЯрзЛржЗ ржжрж░ржХрж╛рж░рж┐, ржкрж░рж┐рж╕рзНржерж┐рждрж┐ ржЕржирзБржпрж╛рзЯрзА ржмрзЗржЫрзЗ ржирж┐ржиред
