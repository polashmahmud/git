# ЁЯЪи `git push --force` ржирж┐рзЯрзЗ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд

`git push --force` (ржмрж╛ рж╕ржВржХрзНрж╖рзЗржкрзЗ `git push -f`) Git-ржПрж░ ржПржХржЯрж┐ рж╢ржХрзНрждрж┐рж╢рж╛рж▓рзА ржХржорж╛ржирзНржб, ржпрж╛ рж▓рзЛржХрж╛рж▓ ржмрзНрж░рж╛ржЮрзНржЪрзЗрж░ ржЗрждрж┐рж╣рж╛рж╕ржХрзЗ **ржЬрзЛрж░ ржХрж░рзЗ** рж░рж┐ржорзЛржЯ рж░рж┐ржкрзЛржЬрж┐ржЯрж░рж┐рждрзЗ ржкрж╛ржарж╛рзЯтАФeven ржпржжрж┐ рж░рж┐ржорзЛржЯрзЗ ржПржоржи ржХржорж┐ржЯ ржерж╛ржХрзЗ ржпрж╛ ржЖржкржирж╛рж░ рж▓рзЛржХрж╛рж▓рзЗ ржирзЗржЗред

ржПржЯрж╛ ржЦрзБржмржЗ рж╢ржХрзНрждрж┐рж╢рж╛рж▓рзА тАФ ржЖржмрж╛рж░ **ржмрж┐ржкржЬрзНржЬржиржХржУ**ред ржнрзБрж▓ржнрж╛ржмрзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж▓рзЗ ржЖржкржирж╛рж░ ржЯрж┐ржоржорзЗржЯржжрзЗрж░ ржХрж╛ржЬ ржорзБржЫрзЗ ржпрзЗрждрзЗ ржкрж╛рж░рзЗред


## ЁЯФН рж╕рж╛ржзрж╛рж░ржг `git push` vs `git push --force`

| `git push`                                             | `git push --force`                            |
| ------------------------------------------------------ | --------------------------------------------- |
| рж░рж┐ржорзЛржЯ рж░рж┐ржкрзЛржЬрж┐ржЯрж░рж┐рждрзЗ ржирждрзБржи ржХржорж┐ржЯ ржкрж╛ржарж╛рзЯ ржпржжрж┐ ржЖржЧрзЗрж░ ржЗрждрж┐рж╣рж╛рж╕ ржорж┐рж▓рзЗ | рж░рж┐ржорзЛржЯ рж░рж┐ржкрзЛржЬрж┐ржЯрж░рж┐рждрзЗ ржЬрзЛрж░ ржХрж░рзЗ рж▓рзЛржХрж╛рж▓рзЗрж░ ржЗрждрж┐рж╣рж╛рж╕ ржмрж╕рж╛рзЯ |
| ржирж┐рж░рж╛ржкржж                                                 | ржмрж┐ржкржЬрзНржЬржиржХ (рж╕рждрж░рзНржХрждрж╛рж░ рж╕рж╛ржерзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи)         |


## ЁЯУМ ржмрзНржпржмрж╣рж╛рж░рзЗрж░ рж╕рж╛ржзрж╛рж░ржг рж░рзВржк

```bash
git push --force origin <branch-name>
```

ржЕржержмрж╛

```bash
git push -f origin <branch-name>
```


## ЁЯФз ржХржЦржи `git push --force` ржкрзНрж░рзЯрзЛржЬржи рж╣рзЯ?

### тЬЕ рзз. ржХржорж┐ржЯ amend ржХрж░рж╛рж░ ржкрж░

```bash
git commit --amend -m "Fix commit message"
git push --force
```

тЮбя╕П ржЖржЧрзЗрж░ ржХржорж┐ржЯ ржмржжрж▓рзЗ ржЧрзЗрж▓рзЗ, Git рж╕рж╛ржзрж╛рж░ржг `push` ржХрж░рждрзЗ ржжрзЗрзЯ ржирж╛ред рждржЦржи `--force` ржжрж░ржХрж╛рж░ред


### тЬЕ рзи. Rebase ржХрж░рж╛рж░ ржкрж░

```bash
git pull --rebase origin main
git push --force
```

тЮбя╕П Rebase ржЗрждрж┐рж╣рж╛рж╕ ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзЗред рждрж╛ржЗ force push ржжрж░ржХрж╛рж░ ржкрзЬрзЗред


### тЬЕ рзй. ржнрзБрж▓ ржХрж░рзЗ ржЕрждрж┐рж░рж┐ржХрзНржд ржлрж╛ржЗрж▓ ржмрж╛ ржнрзБрж▓ commit ржХрж░рж▓рзЗ

```bash
git reset --hard HEAD~1
git push --force
```

тЮбя╕П ржПржХ ржзрж╛ржк ржкрзЗржЫржирзЗ ржЧрж┐рзЯрзЗ ржЖржЧрзЗрж░ ржХржорж┐ржЯ ржмрж╛рждрж┐рж▓ ржХрж░рзЗ ржЬрзЛрж░ ржХрж░рзЗ ржЖржкржбрзЗржЯ ржкрж╛ржарж╛ржирзЛред


## ЁЯТб ржЙржжрж╛рж╣рж░ржгрж╕ржорзВрж╣

### ЁЯзк ржЙржжрж╛рж╣рж░ржг рзз: ржнрзБрж▓ commit ржорзБржЫрзЗ ржжрж┐рзЯрзЗ push ржХрж░рж╛

```bash
git reset --hard HEAD~2
git push --force
```

тЮбя╕П рж╢рзЗрж╖ рзиржЯрж┐ ржХржорж┐ржЯ ржмрж╛рждрж┐рж▓ ржХрж░рзЗ рж░рж┐ржорзЛржЯрзЗржУ ржорзБржЫрзЗ ржлрзЗрж▓ржмрзЗред


### ЁЯзк ржЙржжрж╛рж╣рж░ржг рзи: history рж╕рж╛ржЬрж┐рзЯрзЗ ржирзЗржУрзЯрж╛

```bash
git rebase -i HEAD~3
# (commit squash ржмрж╛ reorder)
git push --force
```

тЮбя╕П ржХржорж┐ржЯржЧрзБрж▓рзЛ merge ржмрж╛ рж╕рж╛ржЬрж┐рзЯрзЗ рж░рж┐ржорзЛржЯрзЗ ржЬрзЛрж░ ржХрж░рзЗ ржЖржкржбрзЗржЯ ржкрж╛ржарж╛ржирзЛред


### ЁЯзк ржЙржжрж╛рж╣рж░ржг рзй: PR-ржПрж░ ржЗрждрж┐рж╣рж╛рж╕ рж╕рзБржирзНржжрж░ ржХрж░рзЗ рж╕рж╛ржЬрж╛ржирзЛ

```bash
git rebase main
git push --force
```

тЮбя╕П pull request ржорж░рзНржЬ ржХрж░рж╛рж░ ржЖржЧрзЗ ржкрж░рж┐ржЪрзНржЫржирзНржи ржЗрждрж┐рж╣рж╛рж╕ рждрзИрж░рж┐ред


## тЪая╕П ржмрж┐ржкржжрзЗрж░ ржЖрж╢ржЩрзНржХрж╛: ржХрзЗржи `--force` ржмрж┐ржкржЬрзНржЬржиржХ?

* ржЖржкржирж┐ ржпржжрж┐ рж░рж┐ржорзЛржЯрзЗ ржПржоржи ржХрж┐ржЫрзБ ржорзБржЫрзЗ ржжрзЗржи ржпрж╛ ржЕржирзНржпрж░рж╛ ржЗрждрж┐ржоржзрзНржпрзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржЫрзЗ, рждрж╛рж╣рж▓рзЗ рждрж╛рж░рж╛ **conflict** ржмрж╛ **data loss** ржкрзЗрждрзЗ ржкрж╛рж░рзЗред
* ржЯрж┐ржорзЗ ржХрж╛ржЬ ржХрж░рж╛рж░ рж╕ржорзЯ **unnecessary force push** ржХрж░рж▓рзЗ рж╕рж╣ржХрж░рзНржорзАрж░рж╛ ржмрж┐ржнрзНрж░рж╛ржирзНржд рж╣рзЯрзЗ ржпрзЗрждрзЗ ржкрж╛рж░рзЗред


## тЬЕ ржмрж┐ржХрж▓рзНржк: `--force-with-lease`

```bash
git push --force-with-lease
```

тЮбя╕П ржПржЯрж┐ `--force` ржПрж░ ржирж┐рж░рж╛ржкржж ржмрж┐ржХрж▓рзНржкред ржПржЯрж┐ ржЖржЧрзЗ ржЪрзЗржХ ржХрж░рзЗ ржирзЗрзЯ тАФ ржХрзЗржЙ рж░рж┐ржорзЛржЯрзЗ ржХрж┐ржЫрзБ ржЖржкржбрзЗржЯ ржХрж░рзЗржЫрзЗ ржХрж┐ржирж╛ред ржпржжрж┐ ржХрж░рзЗ ржерж╛ржХрзЗ, рждрж╛рж╣рж▓рзЗ `push` рж╣ржмрзЗ ржирж╛ред

ЁЯФС ржПржЯрж┐ ржЯрж┐ржорзЗ ржХрж╛ржЬ ржХрж░рж╛рж░ рж╕ржорзЯ `--force` ржПрж░ ржерзЗржХрзЗ ржЕржирзЗржХ ржирж┐рж░рж╛ржкржжред


## ЁЯОп ржХрж┐ржнрж╛ржмрзЗ ржмрзБржЭржмрзЗржи ржХржЦржи `--force` ржХрж░рж╛ ржарж┐ржХ?

| ржкрж░рж┐рж╕рзНржерж┐рждрж┐                       | `--force` ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗржи?             |
| ------------------------------- | ------------------------------------ |
| ржЖржкржирж┐ ржПржХрж╛ржЗ ржХрж╛ржЬ ржХрж░ржЫрзЗржи             | тЬФя╕П рж╣рзНржпрж╛ржБ                             |
| ржЯрж┐ржорзЗ ржПржХрж╛ржзрж┐ржХ ржбрзЗржнрзЗрж▓ржкрж╛рж░ ржХрж╛ржЬ ржХрж░ржЫрзЗ   | тЪая╕П `--force-with-lease` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи |
| PR ржПрж░ ржЖржЧрзЗрж░ ржХржорж┐ржЯ ржарж┐ржХ ржХрж░рждрзЗ ржЪрж╛ржи    | тЬФя╕П рж╣рзНржпрж╛ржБ, рждржмрзЗ рж╕рждрж░рзНржХ рж╣рзЯрзЗ              |
| ржЕржирзНржп ржХрзЗржЙ рж╕рзЗржЗ ржмрзНрж░рж╛ржЮрзНржЪрзЗржУ ржХрж╛ржЬ ржХрж░ржЫрзЗ | тЭМ ржирж╛, ржирж╛ ржмрзБржЭрзЗ ржХрж░ржмрзЗржи ржирж╛               |


## ЁЯзп ржнрзБрж▓ force-push ржХрж░рзЗ ржлрзЗрж▓рж▓рзЗ ржХрзА ржХрж░ржмрзЗржи?

1. **ржЖржкржирж╛рж░ рж▓рзЛржХрж╛рж▓ reflog ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЖржЧрзЗрж░ ржЕржмрж╕рзНржерж╛рзЯ ржлрж┐рж░рзБржи:**

```bash
git reflog
git reset --hard <previous-commit-id>
git push --force
```

2. **рж░рж┐ржорзЛржЯ рж░рж┐ржкрзЛржЬрж┐ржЯрж░рж┐ ржмрзНржпрж╛ржХржЖржк ржерж╛ржХрж▓рзЗ restore ржХрж░рзБржиред**

## ЁЯзн Workflow ржЙржжрж╛рж╣рж░ржг: Safe force push

```bash
# ржирждрзБржи ржмрзНрж░рж╛ржЮрзНржЪрзЗ ржХрж╛ржЬ
git checkout -b feature/profile-ui

# ржнрзБрж▓ commit
git add .
git commit -m "Wrong files"

# Reset ржХрж░рзЗ рж╕ржарж┐ржХ commit
git reset HEAD~1
git add .
git commit -m "Add user profile layout"

# Push with force (since history changed)
git push --force-with-lease origin feature/profile-ui
```

## ЁЯФЪ ржЙржкрж╕ржВрж╣рж╛рж░

ЁЯСЙ `git push --force` ржПржХржЯрж┐ рж╢ржХрзНрждрж┐рж╢рж╛рж▓рзА ржЕрж╕рзНрждрзНрж░ред ржнрж╛рж▓рзЛржнрж╛ржмрзЗ ржирж╛ ржЬрзЗржирзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж▓рзЗ ржмрж┐ржкржж рж╣рждрзЗ ржкрж╛рж░рзЗред
ЁЯСЙ рж╕рж░рзНржмржжрж╛ `--force-with-lease` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ ржмрзБржжрзНржзрж┐ржорж╛ржирзЗрж░ ржХрж╛ржЬред
ЁЯСЙ ржПржХржХ ржкрзНрж░ржЬрзЗржХрзНржЯрзЗ ржПржХрж╛ ржХрж╛ржЬ ржХрж░рж▓рзЗ `--force` ржЭрзБржБржХрж┐ржорзБржХрзНржд, ржХрж┐ржирзНрждрзБ ржЯрж┐ржорзЗ ржХрж╛ржЬ ржХрж░рж▓рзЗ рж╕рждрж░рзНржХрждрж╛ ржЬрж░рзБрж░рж┐ред
